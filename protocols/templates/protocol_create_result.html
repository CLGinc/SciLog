{% extends "base/base.html" %}
{% load staticfiles %}
{% block title %}Sci Log - New result{% endblock %}
{% block body %}
{% include "base/toolbar.html" %}
<header class="mdc-toolbar mdl-color--blue-500 mdc-toolbar--fixed">
  <div class="mdc-toolbar__row padding-16">
    <section class="mdc-toolbar__section mdc-toolbar__section--align-start">
      <a data-mdc-auto-init="MDCRipple"
         class="mdc-button mdl-color-text--white"
         href="change to selected_protocol url">
        <i class="material-icons">close</i>
        <span class="toolbar__button-label">Cancel</span>
      </a>
    </section>
    <section class="mdc-toolbar__section">
      <span class="mdc-toolbar__title">Adding result for protocol {{ selected_protocol.name }}</span>
    </section>
    <section class="mdc-toolbar__section mdc-toolbar__section--align-end">
      <button data-mdc-auto-init="MDCRipple"
              data-trigger="submit-result"
              data-form="create_protocol_result_form"
              class="mdc-button mdl-color-text--white">
        <i class="material-icons">check</i>
        <span class="toolbar__button-label">Save</span>
      </button>
    </section>
  </div>
</header>
<div class="content">
{% include "base/drawer.html" %}
  <div class="main-grid mdc-layout-grid">
    <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
      <h1 class="mdc-typography--headline mdl-color-text--blue-500 subpageheader">
        Result details
      </h1>
      <div>
        {% if form.nonfield_errors %}
          {{ form.nonfield_errors }}
        {% endif %}
        {% if data_columns_formset.nonfield_errors %}
          {{ data_columns_formset.nonfield_errors }}
        {% endif %}
      </div>
      <form class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-12 margin--none padding-0"
            id="create_protocol_result_form"
            method="post"
            action="">
        {% csrf_token %}
        {{ data_columns_formset.management_form }}
        <input class="hidden" name="protocol" value="{{ selected_protocol.uuid }}"/>
        <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-12 margin--none padding-0">
          <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-4 margin--none padding-0">
            <p class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12 mdl-color-text--light-blue-500 mdc-typography--subhead">Status</p>
            <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12 margin--none">
              <div class="mdc-form-field">
                <div class="mdc-checkbox">
                  <input type="checkbox"
                         id="success-checkbox"
                         name="is_successful"
                         {% if form.is_successful.data %}checked{% endif %}
                         class="mdc-checkbox__native-control"/>
                  <div class="mdc-checkbox__background">
                    <svg class="mdc-checkbox__checkmark"
                         viewBox="0 0 24 24">
                      <path class="mdc-checkbox__checkmark__path"
                            fill="none"
                            stroke="white"
                            d="M1.73,12.91 8.1,19.28 22.79,4.59"/>
                    </svg>
                    <div class="mdc-checkbox__mixedmark"></div>
                  </div>
                </div>
                <label for="success-checkbox">Success</label>
              </div>
              {% if form.is_successful.errors %}
                <p class="mdc-textfield-helptext mdc-textfield-helptext--persistent mdc-textfield-helptext--validation-msg" role="alert">
                  {{ form.is_successful.errors.as_text }}
                </p>
              {% endif %}
            </div>
          </div>
          <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-4 margin--none padding-0">
            <p class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12 mdl-color-text--light-blue-500 mdc-typography--subhead">State</p>
            <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12 margin--none">
              <select class="mdc-select margin--none" name="state">
                {% for key, value in form.state.field.choices %}
                <option value="{{ key }}" {% if form.state.data == key %}selected{% endif %}>{{ value }}</option>
                {% endfor %}
              </select>
            </div>
            {% if form.state.errors %}
              <p class="mdc-textfield-helptext mdc-textfield-helptext--persistent mdc-textfield-helptext--validation-msg" role="alert">
                {{ form.state.errors.as_text }}
              </p>
            {% endif %}
          </div>
          <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-4 margin--none padding-0">
            <p class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12 mdl-color-text--light-blue-500 mdc-typography--subhead">Linked protocol</p>
            <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12 margin--none">
              {{ selected_protocol.name }}
            </div>
          </div>
        </div>
        <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-12 margin--none padding--top-24 padding-0">
          <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-6 margin--none padding-0">
            <p class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12 mdl-color-text--light-blue-500 mdc-typography--subhead">Result note</p>
            <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12 margin--none">
              <div class="mdc-textfield {% if form.name.errors %}mdc-textfield--invalid{% endif %}" data-mdc-auto-init="MDCTextfield">
                <input class="mdc-textfield__input" type="text"
                       name="note"
                       maxlength="255" {% if form.note.data %}value="{{ form.note.data }}"{% endif %}>
                <label class="mdc-textfield__label">Result note</label>
              </div>
              {% if form.note.errors %}
                <p class="mdc-textfield-helptext mdc-textfield-helptext--persistent mdc-textfield-helptext--validation-msg" role="alert">
                  {{ form.note.errors.as_text }}
                </p>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-12 margin--none padding-0">
          <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12 mdl-color-text--light-blue-500 mdc-typography--subhead">
            <span>Data tables</span>
            <div data-mdc-auto-init="MDCRipple"
               href="#"
               data-trigger="addDataColumn"
               class="mdc-button mdl-color-text--blue-grey-600 right">
              <i class="material-icons mdl-color-text--blue-500">playlist_add</i> Add data column
            </div>
          </div>
          {% for data_column_form in data_columns_formset.forms %}
          <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-12 margin--none padding-0" data-content="dataTable--parent">
            <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-3 dataTable--column" data-order="0">
              <input type="text"
                     name="data_columns-{% if data_column_form.order.data %}{{ data_column_form.order.data }}{% else %}0{% endif %}-order"
                     value="{% if data_column_form.order.data %}{{ data_column_form.order.data }}{% else %}0{% endif %}"
                     data-content="order"
                     class="hidden">
              <input type="text"
                     name="data_columns-{% if data_column_form.order.data %}{{ data_column_form.order.data }}{% else %}0{% endif %}-data"
                     value="0"
                     data-content="data-merged"
                     class="hidden"
                     {% if data_column_form.data.data %}value="{{ data_column_form.data.data }}"{% endif %}>
              <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">
                <thead>
                  <tr>
                    <th class="mdl-data-table__cell--non-numeric" colspan="2">Title</th>
                    <th>
                      <i class="material-icons list--link-remove"
                        data-trigger="remove-table">clear</i>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="mdl-data-table__cell--non-numeric" colspan="3">
                      <input type="text"
                             class="width--full"
                             name="data_columns-{% if data_column_form.order.data %}{{ data_column_form.order.data }}{% else %}0{% endif %}-title"
                             data-content="title"
                             {% if data_column_form.title.data %}value="{{ data_column_form.title.data }}"{% endif %}>
                       {% if data_column_form.title.errors %}
                         <p class="mdc-textfield-helptext mdc-textfield-helptext--persistent mdc-textfield-helptext--validation-msg" role="alert">
                           {{ data_column_form.title.errors.as_text }}
                         </p>
                       {% endif %}
                    </td>
                  </tr>
                </tbody>
                <thead>
                  <tr>
                    <th class="mdl-data-table__cell--non-numeric" colspan="2">Measurement</th>
                    <th class="mdl-data-table__cell--non-numeric">Unit</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="mdl-data-table__cell--non-numeric" colspan="2">
                      <input type="text"
                             class="width--full"
                             name="data_columns-{% if data_column_form.order.data %}{{ data_column_form.order.data }}{% else %}0{% endif %}-measurement"
                             data-content="measurement"
                             {% if data_column_form.measurement.data %}value="{{ data_column_form.measurement.data }}"{% endif %}>
                      {% if data_column_form.measurement.errors %}
                       <p class="mdc-textfield-helptext mdc-textfield-helptext--persistent mdc-textfield-helptext--validation-msg" role="alert">
                         {{ data_column_form.measurement.errors.as_text }}
                       </p>
                      {% endif %}
                    </td>
                    <td class="mdl-data-table__cell--non-numeric">
                      <input type="text"
                             class="width--full"
                             name="data_columns-{% if data_column_form.order.data %}{{ data_column_form.order.data }}{% else %}0{% endif %}-unit"
                             data-content="unit"
                             {% if data_column_form.unit.data %}value="{{ data_column_form.unit.data }}"{% endif %}>
                      {% if data_column_form.unit.errors %}
                        <p class="mdc-textfield-helptext mdc-textfield-helptext--persistent mdc-textfield-helptext--validation-msg" role="alert">
                          {{ data_column_form.unit.errors.as_text }}
                        </p>
                      {% endif %}
                    </td>
                  </tr>
                </tbody>
                <thead>
                  <tr>
                    <th class="mdl-data-table__cell--non-numeric" colspan="2">Data</th>
                    <th>
                      remove / add
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="mdl-data-table__cell--non-numeric" colspan="2">
                      <input type="text"
                             class="width--full"
                             data-content="data">
                      {% if data_column_form.data.errors %}
                        <p class="mdc-textfield-helptext mdc-textfield-helptext--persistent mdc-textfield-helptext--validation-msg" role="alert">
                          {{ data_column_form.data.errors.as_text }}
                        </p>
                      {% endif %}
                    </td>
                    <td>
                      <i class="material-icons list--link-remove" data-trigger="remove--datarow" data-mdc-auto-init="MDCRipple">clear</i>
                      <i class="material-icons list--link-add" data-trigger="add--datarow">add</li>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          {% endfor %}
        </div>
      </form>
    </div>
  </div>
</div>
<div id="modal--attachments" class="modal visible mdc-layout-grid">
  <div class="article--modal padding-0 mdc-elevation--z16 mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
    <header class="mdc-toolbar mdl-color--blue-500 mdc-elevation--z2">
      <div class="mdc-toolbar__row padding-16">
        <section class="mdc-toolbar__section mdc-toolbar__section--align-start">
          <a data-mdc-auto-init="MDCRipple"

             data-target="modal--attachments"
             class="mdc-button mdl-color-text--white">
            <i class="material-icons">close</i>
            <span class="toolbar__button-label">Cancel</span>
          </a>
        </section>
        <section class="mdc-toolbar__section">
          <span class="mdc-toolbar__title">Select files to attach</span>
        </section>
        <section class="mdc-toolbar__section mdc-toolbar__section--align-end">
          <button data-mdc-auto-init="MDCRipple"

                  data-form="create_protocol_result_form"
                  class="mdc-button mdl-color-text--white">
            <i class="material-icons">check</i>
            <span class="toolbar__button-label">Done</span>
          </button>
        </section>
      </div>
    </header>
    <div id="add_attachments" class="modal--content">
      <form action="/file-upload" class="dropzone">
        <div class="fallback">
          <input name="file" type="file" multiple />
        </div>
      </form>
    </div>
  </div>
</div>
<button data-mdc-auto-init="MDCRipple"
        data-trigger="show"
        data-target="modal--attachments"
        id="button-add"
        class="button--attachments mdc-fab mdc-fab--mini material-icons mdl-color--blue-500">
  <span  class="mdc-fab__icon">cloud_upload</span>
</button>
<div class="mdc-snackbar mdl-color--blue-500"
     aria-live="assertive"
     aria-atomic="true"
     aria-hidden="true" id="mdc-js-snackbar">
  <div class="mdc-snackbar__text"></div>
  <div class="mdc-snackbar__action-wrapper">
    <button type="button" class="mdc-button mdc-snackbar__action-button"></button>
  </div>
</div>
{% include "base/scroll_top.html" %}
{% endblock %}
{% block post_load %}
<script type = "text/javascript" src="{% static "front/js/ajax.js" %}"></script>
<script type = "text/javascript" src="{% static "front/js/triggers.js" %}"></script>
<script type = "text/javascript" src="{% static "front/js/datacolumns.js" %}"></script>
<script type = "text/javascript" src="{% static "front/js/dropzone.js" %}"></script>
<script>
  var MDCSnackbar = mdc.snackbar.MDCSnackbar;
  var snackbar = new MDCSnackbar(document.getElementById('mdc-js-snackbar'));
  var show = function(sb) {
    var data =  {
      message: 'At least one data column is required'
    };
    sb.show(data);
  };
  </script>
{% endblock %}
