{% extends "base/base.html" %}
{% load staticfiles %}
{% block title %}Sci Log - Project Name{% endblock %}
{% block body %}
  <div class="layout mdl-layout mdl-js-layout mdl-layout--fixed-drawer mdl-layout--fixed-header">
    {% include "base/top_header.html" %}
    {% include "base/drawer.html" %}
    <main class="mdl-layout__content">
      <div class="page-content mdl-grid">
        <div class="mdl-cell mdl-cell--12-col">
          <h1 class="mdl-typography--headline mdl-color-text--blue-500 subpageheader">
            {{ selected_project.name }}
            <p class="mdl-typography--caption mdl-color-text--blue-grey-500">Created on: {{ selected_project.datetime_created }}</p>
          </h1>
        </div>
        <div class="mdl-cell mdl-cell--9-col">
          <div class="mdl-card width--full">
            <div class="mdl-card__title mdl-color-text--blue-500 padding--left-none">
              <h2 class="mdl-card__title-text">Description</h2>
            </div>
            <div class="mdl-card__supporting-text mdl-color-text--blue-grey-900 padding--left-none">
              {{ selected_project.description }}
            </div>
          </div>
          <div class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect mdl-grid mdl-grid--no-spacing">
            <div class="mdl-tabs__tab-bar mdl-cell mdl-cell--12-col block">
              <a href="#results-panel" data-trigger="tab"  data-target="none" class="mdl-tabs__tab is-active padding--left-none">
                <h2 class="mdl-card__title-text">Results</h2>
              </a>
              <a href="#protocols-panel" data-trigger="tab"  data-target="modal--protocols" class="mdl-tabs__tab">
                <h2 class="mdl-card__title-text">Protocols</h2>
              </a>
              <a href="#sources-panel" data-trigger="tab" data-target="modal--sources" class="mdl-tabs__tab">
                <h2 class="mdl-card__title-text">Sources</h2>
              </a>
              {% if can_edit %}
              <button data-trigger="show" data-ajax="addDataRequest" id="button-add" class="mdl-button mdl-color-text--blue-grey-600 mdl-js-button mdl-js-ripple-effect right hidden">
                <i class="material-icons mdl-color-text--blue-500">playlist_add</i> Add
              </button>
              {% endif %}
            </div>
            <div class="mdl-tabs__panel is-active mdl-cell mdl-cell--12-col padding--top-24" id="results-panel">
              {% if results_page %}
              <ul class="mdl-list margin--bottom-0">
                <li class="mdl-grid mdl-grid--no-spacing mdl-cell--hide-phone mdl-list__item border--bottom mdl-color-text--blue-500">
                  <div class="mdl-grid mdl-cell mdl-cell--11-col">
                    <div class="mdl-cell mdl-cell--4-col">Protocol</div>
                    <div class="mdl-cell mdl-cell--3-col">Created by</div>
                    <div class="mdl-cell mdl-cell--3-col">Created on</div>
                    <div class="mdl-cell mdl-cell--1-col">State</div>
                    <div class="mdl-cell mdl-cell--1-col">Success</div>
                  </div>
                  <div class="mdl-grid mdl-cell mdl-cell--1-col">
                    <div class="mdl-cell mdl-cell--1-col">Modify</div>
                  </div>
                </li>
                <li>
                  <ul class="mdl-list padding--top-none" id="items_list" data-mode="infinitescroll" data-pages="{{ paginator.num_pages }}">
                    {% for result in results_page %}
                		<li class="mdl-list__item border--bottom mdl-grid mdl-grid--no-spacing">
                      <a href="/resultid/" class="links--wrap mdl-grid mdl-cell mdl-cell--11-col list--link">
                        <div class="mdl-cell mdl-cell--4-col">{{ result.protocol }}</div>
                        <div class="mdl-cell mdl-cell--3-col">{{ result.owner }}</div>
                        <div class="mdl-cell mdl-cell--3-col">{{ result.datetime_created }}</div>
                        <div class="mdl-cell mdl-cell--1-col">{{ result.get_state_display }}</div>
                        {% if result.is_successful == True %}
                        <div class="mdl-cell mdl-cell--1-col mdl-color-text--green-600 mdl-typography--text-center">Yes</div>
                        {% else %}
                        <div class="mdl-cell mdl-cell--1-col mdl-color-text--pink-600 mdl-typography--text-center">No</div>
                        {% endif %}
                      </a>
                      <div class="mdl-grid mdl-cell mdl-cell--1-col mdl-cell--12-col-phone">
                        <button class="mdl-button mdl-js-button mdl-button--icon mdl-color-text--blue-grey-600">
                          <i class="material-icons list--link-edit">edit</i>
                        </button>
                        <button class="mdl-button mdl-js-button mdl-button--icon mdl-color-text--blue-grey-600">
                          <i class="material-icons list--link-remove">clear</i>
                        </button>
                      </div>
                		</li>
                    {% endfor %}
                  </ul>
                </li>
            	</ul>
              {% else %}
              <div class="mdl-cell mdl-cell--12-col mdl-grid mdl-grid--no-spacing">
                <div class="mdl-card width--full">
                  <div class="mdl-card__title">
                    <h2 class="mdl-card__title-text mdl-color-text--accent">No results</h2>
                  </div>
                  <div class="mdl-card__supporting-text mdl-color-text--blue-grey-900">
                    There are no results yet. Use the '+ ADD' button to add more.
                  </div>
                </div>
              </div>
              {% endif %}
              <div class="mdl-cell mdl-cell--12-col mdl-grid">
                <div class="mdl-layout-spacer"></div>
                <div class="mdl-spinner mdl-js-spinner" id="loading"></div>
                <div class="mdl-layout-spacer"></div>
              </div>
            </div>
            <div class="mdl-tabs__panel mdl-cell mdl-cell--12-col padding--top-24" id="protocols-panel">
              {% if selected_project.protocols.all %}
              <ul class="mdl-list margin--bottom-0">
                <li class="mdl-grid mdl-grid--no-spacing mdl-cell--hide-phone mdl-list__item border--bottom mdl-color-text--blue-500">
                  <div class="mdl-grid mdl-cell mdl-cell--11-col">
                    <div class="mdl-cell mdl-cell--7-col">Name</div>
                    <div class="mdl-cell mdl-cell--4-col">Owner</div>
                    <div class="mdl-cell mdl-cell--1-col">Label</div>
                  </div>
                  <div class="mdl-grid mdl-cell mdl-cell--1-col">
                    <div class="mdl-cell mdl-cell--1-col">Modify</div>
                  </div>
                </li>
                {% for protocol in selected_project.protocols.all %}
            		<li class="mdl-list__item border--bottom mdl-grid mdl-grid--no-spacing">
                  <a href="/resultid/" class="links--wrap mdl-grid mdl-cell mdl-cell--11-col list--link">
                    <div class="mdl-cell mdl-cell--7-col">{{ protocol.name }}</div>
                    <div class="mdl-cell mdl-cell--4-col">{{ protocol.get_owner }}</div>
                    <div class="mdl-cell mdl-cell--1-col">{{ protocol.get_label_display }}</div>
                  </a>
                  <div class="mdl-grid mdl-cell mdl-cell--1-col mdl-cell--12-col-phone">
                    <button class="mdl-button mdl-js-button mdl-button--icon mdl-color-text--blue-grey-600">
                      <i class="material-icons list--link-edit">edit</i>
                    </button>
                    <button class="mdl-button mdl-js-button mdl-button--icon mdl-color-text--blue-grey-600">
                      <i class="material-icons list--link-remove">clear</i>
                    </button>
                  </div>
            		</li>
                {% endfor %}
            	</ul>
              {% else %}
              <div class="mdl-cell mdl-cell--12-col mdl-grid mdl-grid--no-spacing">
                <div class="mdl-card width--full">
                  <div class="mdl-card__title">
                    <h2 class="mdl-card__title-text mdl-color-text--accent">No protocols</h2>
                  </div>
                  <div class="mdl-card__supporting-text mdl-color-text--blue-grey-900">
                    There are no protocols yet. Use the '+ ADD' button to add more.
                  </div>
                </div>
              </div>
              {% endif %}
            </div>
            <div class="mdl-tabs__panel mdl-cell mdl-cell--12-col padding--top-24" id="sources-panel">
              {% if selected_project.sources.all %}
              <ul class="mdl-list margin--bottom-0">
                <li class="mdl-grid mdl-grid--no-spacing mdl-cell--hide-phone mdl-list__item border--bottom mdl-color-text--blue-500">
                  <div class="mdl-grid mdl-cell mdl-cell--9-col">
                    <div class="mdl-cell mdl-cell--8-col">Name</div>
                    <div class="mdl-cell mdl-cell--4-col">ISBN</div>
                  </div>
                  <div class="mdl-grid mdl-cell mdl-cell--2-col">
                    <div class="mdl-cell mdl-cell--7-col">Url</div>
                  </div>
                  <div class="mdl-grid mdl-cell mdl-cell--1-col">
                    <div class="mdl-cell mdl-cell--1-col">Modify</div>
                  </div>
                </li>
                {% for source in selected_project.sources.all %}
            		<li class="mdl-list__item border--bottom mdl-grid mdl-grid--no-spacing">
                  <a href="/resultid/" class="links--wrap mdl-grid mdl-cell mdl-cell--9-col list--link">
                    <div class="mdl-cell mdl-cell--8-col">{{ source.name }}</div>
                    <div class="mdl-cell mdl-cell--4-col">{{ source.isbn }}</div>
                  </a>
                  <div class="links--wrap mdl-grid mdl-cell mdl-cell--2-col list--link">
                    <a href="{{ source.url }}" target="_blank" class="links--wrap mdl-cell mdl-cell--12-col">
                      {% if source.url %}
                      Visit site
                      {% endif %}
                    </a>
                  </div>
                  <div class="links--wrap mdl-grid mdl-cell mdl-cell--1-col mdl-cell--12-col-phone">
                    <button class="mdl-button mdl-js-button mdl-button--icon mdl-color-text--blue-grey-600">
                      <i class="material-icons list--link-edit">edit</i>
                    </button>
                    <button class="mdl-button mdl-js-button mdl-button--icon mdl-color-text--blue-grey-600">
                      <i class="material-icons list--link-remove">clear</i>
                    </button>
                  </div>
            		</li>
                {% endfor %}
            	</ul>
              {% else %}
              <div class="mdl-cell mdl-cell--12-col mdl-grid mdl-grid--no-spacing">
                <div class="mdl-card width--full">
                  <div class="mdl-card__title">
                    <h2 class="mdl-card__title-text mdl-color-text--accent">No sources</h2>
                  </div>
                  <div class="mdl-card__supporting-text mdl-color-text--blue-grey-900">
                    There are no sources yet. Use the '+ ADD' button to add more.
                  </div>
                </div>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="mdl-cell mdl-cell--3-col">
          <div class="participant-list">
            <div class="mdl-card__title mdl-color-text--blue-500 mdl-grid">
              <h2 class="mdl-card__title-text">Participants</h2>
              <div class="mdl-layout-spacer"></div>
              {% if can_edit %}
              <button data-trigger="filter-togglebtn" data-state="open" data-target="modal--participants" id="button--add-participants" class="mdl-button mdl-color-text--blue-grey-600 mdl-js-button mdl-js-ripple-effect button--height-normal">
                <i data-content="open-close-icon" class="material-icons mdl-color-text--blue-500">playlist_add</i>
                <span data-content="open-close-text">Add</span>
              </button>
              {% endif %}
            </div>
            <div id="modal--participants" class="mdl-grid mdl-cell mdl-cell--12-col filter-form">
              <div class="mdl-textfield mdl-js-textfield hidden" id="email_input_source">
                <a data-trigger="remove-input" class="mdl-button mdl-js-button mdl-button--icon mdl-color-text--blue-grey-600 input--remove">
                  <i class="material-icons mdl-color-text--blue-500">close</i>
                </a>
                <input class="mdl-textfield__input" type="email" name="email">
                <label class="mdl-textfield__label">Email</label>
                <input class="hidden" type="text" name="inviter" value="{{ researcher.id }}">
                <input class="hidden" type="text" name="project" value="{{ selected_project.id }}">
              </div>
              <form method="post" action="{% url 'create_invitation' %}" id="participant_invite_form">
                {% csrf_token %}
                <div class="mdl-textfield mdl-js-textfield" id="email_input_1">
                  <a data-trigger="remove-input" class="mdl-button mdl-js-button mdl-button--icon mdl-color-text--blue-grey-600 input--remove">
                    <i class="material-icons mdl-color-text--blue-500">close</i>
                  </a>
                  <input class="mdl-textfield__input" type="email" name="email">
                  <label class="mdl-textfield__label">Email</label>
                  <input class="hidden" type="text" name="inviter" value="{{ researcher.id }}">
                  <input class="hidden" type="text" name="project" value="{{ selected_project.id }}">
                </div>
              </form>
              <a data-trigger="submit-ajax" data-target="modal--participants" data-form="participant_invite_form" class="mdl-button mdl-js-button mdl-color-text--blue-grey-600">
                <i class="material-icons mdl-color-text--blue-500">playlist_add</i>
                Send
              </a>
              <a data-trigger="add-input" data-target="email_input_source" data-currentid="1" data-form="participant_invite_form" class="mdl-button mdl-js-button mdl-color-text--blue-grey-600">
                <i class="material-icons mdl-color-text--blue-500">add</i>
                More
              </a>
            </div>
            <div class="mdl-card__supporting-text">
              <ul class="mdl-list margin--none padding--top-none">
                {% for role_value, roles in participants_by_role %}
                <li class="mdl-list__item padding--left-none participant-list--role">{{ role_value }}</li>
                  {% for role in roles %}
                  <a class="links--wrap" href="/userid/">
                    <li class="mdl-list__item padding--left-none participant-list--link">
                      <span class="mdl-list__item-primary-content">
                        <img class="participant-list--avatar" src="/static/front/img/ninja.png">
                          <span>{{ role.researcher }}</span>
                      </span>
                    </li>
                  </a>
                  {% endfor %}
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>
        <div id="modal--protocols" class="modal mdl-grid mdl-cell mdl-cell--12-col visible" data-request="protocols_to_add">
          <div class="mdl-card mdl-shadow--16dp mdl-cell mdl-cell--12-col mdl-grid visible mdl-grid--no-spacing" role="dialog" aria-hidden="true">
            <div class="mdl-card__title mdl-cell mdl-cell--12-col mdl-color--blue-500 mdl-shadow--2dp">
              <h2 class="mdl-card__title-text mdl-color-text--white">Add protocols</h2>
            </div>
            <div class="mdl-progress mdl-js-progress mdl-progress__indeterminate width--full" data-type="loader"></div>
            <div class="mdl-card__supporting-text modal--content mdl-cell mdl-cell--12-col">
              <div id="protocols_to_add">

              </div>
            </div>
            <div class="modal--button-container mdl-color--blue-500 mdl-shadow--8dp">
              <a data-trigger="submit" data-target="modal--protocols" data-form="form--protocols" class="mdl-button mdl-js-button mdl-color-text--white modal--button">
                <i class="material-icons">playlist_add</i>
                ADD
              </a>
              <a data-trigger="close"  data-target="modal--protocols" class="mdl-button mdl-js-button mdl-color-text--white">
                <i class="material-icons">close</i>
                Cancel
              </a>
            </div>
          </div>
        </div>
        <div id="modal--sources" class="modal mdl-grid mdl-cell mdl-cell--12-col visible" data-request="sources_to_add">
          <div class="mdl-card mdl-shadow--16dp mdl-cell mdl-cell--12-col mdl-grid visible mdl-grid--no-spacing" role="dialog" aria-hidden="true">
            <div class="mdl-card__title mdl-cell mdl-cell--12-col mdl-color--blue-500 mdl-shadow--2dp">
              <h2 class="mdl-card__title-text mdl-color-text--white">Add sources</h2>
            </div>
            <div class="mdl-progress mdl-js-progress mdl-progress__indeterminate width--full hidden" data-type="loader"></div>
            <div class="mdl-card__supporting-text modal--content mdl-cell mdl-cell--12-col">
              <div id="sources_to_add">

              </div>
            </div>
            <div class="modal--button-container mdl-color--blue-500 mdl-shadow--8dp">
              <a data-trigger="submit" data-target="modal--sources" data-form="form--sources" class="mdl-button mdl-js-button mdl-color-text--white modal--button">
                <i class="material-icons">playlist_add</i>
                ADD
              </a>
              <a data-trigger="close"  data-target="modal--sources" class="mdl-button mdl-js-button mdl-color-text--white">
                <i class="material-icons">close</i>
                Cancel
              </a>
            </div>
          </div>
        </div>
      </div>
      {% include "base/scroll_top.html" %}
    </main>
  </div>
{% endblock %}
{% block post_load %}
  <script type = "text/javascript" src="{% static "front/js/ajax.js" %}"></script>
  <script type = "text/javascript" src="{% static "front/js/infiniteScroll.js" %}"></script>
  <script type = "text/javascript" src="{% static "front/js/triggers.js" %}"></script>
  <script type = "text/javascript" src="{% static "front/js/addDataRequest.js" %}"></script>
{% endblock %}
