{% extends "base/base.html" %}
{% load staticfiles %}
{% block title %}Sci Log - {{ selected_project.name }}{% endblock %}
{% block body %}
{% include "base/toolbar.html" %}
<div class="content">
{% include "base/drawer.html" %}
  <div class="main-grid mdc-layout-grid">
    <form class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-12 padding-0"
          method="post"
          action="{% url 'project' project_uid=object.unique_id %}">
      {% csrf_token %}
      <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-9">
        <h1 class="subpageheader--project">
          <div class="mdc-textfield mdc-textfield--upgraded input--temp padding-0" data-mdc-auto-init="MDCTextfield">
              <input type="text" id="project_name"
                     class="editable mdc-textfield__input mdc-typography--headline mdl-color-text--blue-500"
                     value="{{ selected_project.name }}"
                     name="name"
                     disabled>
          </div>
          <p class="mdc-textfield-helptext mdc-textfield-helptext--persistent">
            Created on: {{ selected_project.datetime_created|date:"d M Y" }}
          </p>
        </h1>
      </div>
      <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-3">
        <button data-mdc-auto-init="MDCRipple" data-trigger="activate" data-target="editable"
                id="button-modify"
                class="mdc-button mdl-color-text--blue-grey-600 subpageheader right">
          <i class="material-icons mdl-color-text--blue-500">edit</i> <span>Edit project<span>
        </button>
      </div>
      <div class="article mdc-layout-grid__cell mdc-layout-grid__cell--span-9">
        <h1 class="mdl-color-text--blue-500 section--title">Description</h1>
        <div class="mdc-textfield mdc-textfield--upgraded input--temp padding-0" data-mdc-auto-init="MDCTextfield">
          <input type="text" id="project_name"
                 class="editable mdc-textfield__input mdl-color-text--blue-grey-900"
                 value="{{ selected_project.description }}"
                 name="description"
                 disabled>
        </div>
      </div>
    </form>
    <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12 mdc-layout-grid padding-0">
      <div class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
        <div class="mdl-tabs__tab-bar block">
          <a href="#results-panel" data-trigger="tab"  data-target="none" class="mdl-tabs__tab is-active padding--left-none">
            <h2 class="section--title">Results</h2>
          </a>
          <a href="#protocols-panel" data-trigger="tab"  data-target="modal--protocols" class="mdl-tabs__tab">
            <h2 class="section--title">Protocols</h2>
          </a>
          <a href="#sources-panel" data-trigger="tab" data-target="modal--sources" class="mdl-tabs__tab">
            <h2 class="section--title">Sources</h2>
          </a>
          <a href="#participants-panel" data-trigger="tab" data-target="none" class="mdl-tabs__tab">
            <h2 class="section--title">Participants</h2>
          </a>
          {% if can_edit %}
          <button data-mdc-auto-init="MDCRipple"
                  data-trigger="show"
                  data-ajax="addDataRequest"
                  id="button-add"
                  class="mdc-button mdl-color-text--blue-grey-600 right hidden">
            <i class="material-icons mdl-color-text--blue-500">playlist_add</i> Add
          </button>
          {% endif %}
        </div>
        <div class="mdl-tabs__panel is-active" id="results-panel">
          {% if selected_project.results.all %}
          <ul class="mdc-list padding-0">
            <li class="mdc-layout-grid border--bottom mdl-color-text--blue-500 padding-0 margin--none">
              <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-11">
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-4">Protocol</div>
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-3">Created by</div>
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2">Created on</div>
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2 text-center">State</div>
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-1 text-center">Success</div>
              </div>
              <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-1">
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">Remove</div>
              </div>
            </li>
          </ul>
          <ul class="mdc-list padding-0">
            {% for result in selected_project.results.all %}
      		  <li class="border--bottom mdc-layout-grid padding-0 margin--none">
              <a href="/resultid/"
                 class="links--wrap mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-11 list--link margin--none">
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-4">{{ result.protocol }}</div>
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-3">{{ result.owner }}</div>
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2">{{ result.datetime_created|date:"d M Y" }}</div>
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2">{{ result.get_state_display|date:"d M Y" }}</div>
                {% if result.is_successful == True %}
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-1 mdl-color-text--green-600 text-center">Yes</div>
                {% else %}
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-1 mdl-color-text--pink-600 text-center">No</div>
                {% endif %}
              </a>
              <button href="#" class="mdc-button mdc-button--icon center padding-8"
                 aria-label="Remove result" title="Remove result" data-mdc-auto-init="MDCRipple">
                <i class="material-icons list--link-remove">clear</i>
              </button>
        		</li>
            {% endfor %}
          </ul>
          {% else %}
          <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
            <div class="article width--full">
              <h1 class="mdl-color-text--accent section--title">No results</h1>
              <p class="mdl-color-text--blue-grey-900">
                There are no results yet. Use the '+ ADD' button to add more.
              </p>
            </div>
          </div>
          {% endif %}
        </div>
        <div class="mdl-tabs__panel" id="protocols-panel">
          {% if selected_project.protocols.all %}
          <ul class="mdc-list padding-0">
            <li class="mdc-layout-grid border--bottom mdl-color-text--blue-500 padding-0 margin--none">
              <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-11">
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-7">Name</div>
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-4">Owner</div>
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-1">Label</div>
              </div>
              <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-1">
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">Remove</div>
              </div>
            </li>
          </ul>
          <ul class="mdc-list padding-0">
            {% for protocol in selected_project.protocols.all %}
        		<li class="border--bottom mdc-layout-grid padding-0 margin--none">
              <a href="/resultid/"
                 class="links--wrap mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-11 list--link margin--none">
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-7">{{ protocol.name }}</div>
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-4">{{ protocol.get_owner }}</div>
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-1">{{ protocol.get_label_display }}</div>
              </a>
              <button href="#" class="mdc-button mdc-button--icon center padding-8"
                 aria-label="Remove result" title="Remove result" data-mdc-auto-init="MDCRipple">
                <i class="material-icons list--link-remove">clear</i>
              </button>
        		</li>
            {% endfor %}
          </ul>
          {% else %}
          <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
            <div class="article width--full">
              <h1 class="mdl-color-text--accent section--title">No protocols</h1>
              <p class="mdl-color-text--blue-grey-900">
                There are no protocols yet. Use the '+ ADD' button to add more.
              </p>
            </div>
          </div>
          {% endif %}
        </div>
        <div class="mdl-tabs__panel" id="sources-panel">
          {% if selected_project.sources.all %}
          <ul class="mdc-list padding-0">
            <li class="mdc-layout-grid border--bottom mdl-color-text--blue-500 padding-0 margin--none">
              <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-11 margin--none">
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-8">Name</div>
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-4">ISBN</div>
              </div>
              <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-2">
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-7">Url</div>
              </div>
              <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-1">
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-1">Remove</div>
              </div>
            </li>
            {% for source in selected_project.sources.all %}
        		<li class="border--bottom mdc-layout-grid padding-0 margin--none">
              <a href="/resultid/"
                 class="links--wrap mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-11 list--link margin--none">
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-8">{{ source.name }}</div>
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-4">{{ source.isbn }}</div>
              </a>
              <div class="margin--none links--wrap mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-2 list--link padding-0">
                <a href="{{ source.url }}" target="_blank" class="links--wrap mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
                  {% if source.url %}
                  Visit site
                  {% endif %}
                </a>
              </div>
              <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-1 padding-0">
                <button href="#" class="mdc-button mdc-button--icon center"
                   aria-label="Remove result" title="Remove result" data-mdc-auto-init="MDCRipple">
                  <i class="material-icons list--link-remove">clear</i>
                </button>
              </div>
        		</li>
          {% endfor %}
          </ul>
          {% else %}
          <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
            <div class="article width--full">
              <h1 class="mdl-color-text--accent section--title">No sources</h1>
              <p class="mdl-color-text--blue-grey-900">
                There are no sources yet. Use the '+ ADD' button to add more.
              </p>
            </div>
          </div>
          {% endif %}
        </div>
        <div class="mdl-tabs__panel" id="participants-panel">
          <div class="mdc-layout-grid padding-0">
            <div class="mdc-layout-grid mdc-layout-grid__cell mdc-layout-grid__cell--span-6 mdc-layout-grid__cell--align-top padding-0">
              <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-4 mdc-list mdl-color-text--blue-500">
                <p>Role</p>
              </div>
              <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-8 mdc-list mdl-color-text--blue-500">
                <p>Email</p>
              </div>
              {% for role_value, roles in participants_by_role %}
              <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-4 mdc-list">
                <p>{{ role_value }}</p>
              </div>
              <ul class="mdc-list mdc-list--avatar-list mdc-layout-grid__cell mdc-layout-grid__cell--span-8">
                {% for role in roles %}
                <li class="mdc-list-item">
                  <a class="links--wrap participant-list--link" href="/userid/">
                    <img class="mdc-list-item__start-detail" src="/static/front/img/ninja.png"
                      width="56" height="56" alt="Avatar of {{ role.researcher }}">
                    {{ role.researcher }}
                  </a>
                </li>
                {% endfor %}
              </ul>
              {% endfor %}
            </div>
            <div id="modal--participants"
                 class="mdc-layout-grid__cell mdc-layout-grid__cell--span-6 mdc-layout-grid__cell--align-top padding-0">
              <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-4 mdc-list mdl-color-text--blue-500">
                <p>Invite participants</p>
              </div>
              <form method="post"
                    action="{% url 'create_invitation' %}"
                    id="email_input_source"
                    class="hidden mdc-list">
                {% csrf_token %}
                <div class="mdc-textfield" data-mdc-auto-init="MDCTextfield">
                  <a data-trigger="remove-input" class="mdc-button mdc-button--icon mdl-color-text--blue-grey-600 input--remove" data-mdc-auto-init="MDCRipple">
                    <i class="material-icons mdl-color-text--blue-500 list--link-remove">close</i>
                  </a>
                  <div data-content="loader" class="mdl-spinner mdl-spinner--single-color mdl-js-spinner input--remove-spinner"></div>
                  <input type="text" name="email" class="mdc-textfield__input">
                  <label class="mdc-textfield__label">Email address</label>
                </div>
                <div class="padding--top-8">
                  <span class="mdc-typography--body">Participant role:</span>
                  <select class="mdc-select"
                          name="role">
                    {% for role, label in invitation_roles %}
                    <option value="{{ role }}" {% if role == default_invitation_role.0 %}default selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                  </select>
                </div>
                <select class="hidden" name="invitation_object" value="project">
                  <option selected value="project">Project</option>
                </select>
                <select class="hidden" name="object_choice" value="{{ selected_project.unique_id }}">
                  <option selected value="{{ selected_project.unique_id }}">{{ selected_project.unique_id }}</option>
                </select>
                <div data-content="result" class="mdc-typography--caption result"></div>
              </form>
              <form method="post"
                    action="{% url 'create_invitation' %}"
                    class="mdc-list">
                {% csrf_token %}
                <div class="mdc-textfield" data-mdc-auto-init="MDCTextfield">
                  <a data-trigger="remove-input" class="mdc-button mdc-button--icon mdl-color-text--blue-grey-600 input--remove" data-mdc-auto-init="MDCRipple">
                    <i class="material-icons mdl-color-text--blue-500 list--link-remove">close</i>
                  </a>
                  <div data-content="loader" class="mdl-spinner mdl-spinner--single-color mdl-js-spinner input--remove-spinner"></div>
                  <input type="text" name="email" class="mdc-textfield__input">
                  <label class="mdc-textfield__label">Email address</label>
                </div>
                <div class="padding--top-8">
                  <span class="mdc-typography--body">Participant role:</span>
                  <select class="mdc-select"
                          name="role">
                    {% for role, label in invitation_roles %}
                    <option value="{{ role }}" {% if role == default_invitation_role.0 %}default selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                  </select>
                </div>
                <select class="hidden" name="invitation_object" value="project">
                  <option selected value="project">Project</option>
                </select>
                <select class="hidden" name="object_choice" value="{{ selected_project.unique_id }}">
                  <option selected value="{{ selected_project.unique_id }}">{{ selected_project.unique_id }}</option>
                </select>
                <div data-content="result" class="mdc-typography--caption result"></div>
              </form>
              <div class="padding--top-24">
                <a data-mdc-auto-init="MDCRipple"
                   data-trigger="submit-ajax"
                   data-target="modal--participants"
                   data-form="participant_invite_form"
                   class="mdc-button mdl-color-text--blue-grey-600">
                  <i class="material-icons mdl-color-text--blue-500">playlist_add</i>
                  Send
                </a>
                <a data-mdc-auto-init="MDCRipple"
                   data-trigger="add-input"
                   data-currentid="1"
                   data-form="email_input_source"
                   class="mdc-button mdl-color-text--blue-grey-600">
                  <i class="material-icons mdl-color-text--blue-500">add</i>
                  More
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="modal--protocols" class="modal visible mdc-layout-grid" data-request="add_protocols">
  <div class="article--modal padding-0 mdc-elevation--z16 mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
    <h1 class="article--modal-title mdl-color--blue-500 mdl-color-text--white width--full">Add protocols</h1>
    <div class="mdl-progress mdl-js-progress mdl-progress__indeterminate width--full" data-type="loader"></div>
    <div id="add_protocols" class="modal--content">

    </div>
    <div class="modal--button-container mdl-color--blue-500 mdl-shadow--8dp">
      <a data-mdc-auto-init="MDCRipple" data-trigger="submit" data-target="modal--protocols" data-form="form--protocols" class="mdc-button mdl-color-text--white modal--button">
        <i class="material-icons">playlist_add</i>
        ADD
      </a>
      <a data-mdc-auto-init="MDCRipple" data-trigger="close"  data-target="modal--protocols" class="mdc-button mdl-color-text--white">
        <i class="material-icons">close</i>
        Cancel
      </a>
    </div>
  </div>
</div>
<div id="modal--sources" class="modal visible mdc-layout-grid" data-request="add_sources">
  <div class="article--modal padding-0 mdc-elevation--z16 mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
    <h1 class="article--modal-title mdl-color--blue-500 mdl-color-text--white width--full">Add sources</h1>
    <div class="mdl-progress mdl-js-progress mdl-progress__indeterminate width--full" data-type="loader"></div>
    <div id="add_sources" class="modal--content">

    </div>
    <div class="modal--button-container mdl-color--blue-500 mdl-shadow--8dp">
      <a data-mdc-auto-init="MDCRipple" data-trigger="submit" data-target="modal--sources" data-form="form--sources" class="mdc-button mdl-color-text--white modal--button">
        <i class="material-icons">playlist_add</i>
        ADD
      </a>
      <a data-mdc-auto-init="MDCRipple" data-trigger="close"  data-target="modal--sources" class="mdc-button mdl-color-text--white">
        <i class="material-icons">close</i>
        Cancel
      </a>
    </div>
  </div>
</div>
{% include "base/scroll_top.html" %}
{% endblock %}
{% block post_load %}
  <script type = "text/javascript" src="{% static "front/js/ajax.js" %}"></script>
  <script type = "text/javascript" src="{% static "front/js/infiniteScroll.js" %}"></script>
  <script type = "text/javascript" src="{% static "front/js/triggers.js" %}"></script>
  <script type = "text/javascript" src="{% static "front/js/addDataRequest.js" %}"></script>
{% endblock %}
